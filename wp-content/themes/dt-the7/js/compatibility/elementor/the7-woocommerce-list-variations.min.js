jQuery((function(t){class e{constructor(t){this.data=t||{},this.data.outOfStockAttributes=this.findOutOfStockAttributes(),this.data.state=this.data.state||{},this.data.$originPrice=this.data.$price.clone()}getState(t){return t?this.data.state[t]:Object.assign({},this.data.state)}render(){const e=this.getState();if(!e)return;const n=this.data.$variations.find("li"),i=Object.keys(e).filter((function(t){return!!t})).map((function(n){return'[data-id="'+t.escapeSelector(e[n])+'"]'})).join(",");n.removeClass("active"),n.find(i).each((function(){t(this).parent().addClass("active")})),this.handleOutOfStockVisibility(this.findMatchingOutOfStockVariations());const a=this.findMatchingVariation();a?(this.data.$addToCartButton.attr("data-product_id",a.variation_id),this.data.$addToCartButton.removeClass("variation-btn-disabled"),a.price_html&&this.updateProductPriceData(t(a.price_html))):(this.data.$addToCartButton.attr("data-product_id",""),this.data.$addToCartButton.addClass("variation-btn-disabled"),this.updateProductPriceData(this.data.$originPrice.clone()))}updateState(t){this.data.state=Object.assign({},this.data.state,t),this.render()}findMatchingVariation(){const t=this.data.variations,e=this.getState();for(var n=[],i=0;i<t.length;i++){var a=t[i];this.isExactMatch(a.attributes,e)&&n.push(a)}return n.shift()}updateProductPriceData(t){this.data.$price.replaceWith(t),this.data.$price=t}getVariationImage(e){const n=this.findFirstMatchingVariationOfGivenState(e);if(!n)return;const i=n.image;return t(`\n                    <img\n                        class="replaced-img preload-me aspect lazy lazy-load"\n                        style="--ratio: ${i.src_w} / ${i.src_h};"\n                        width="${i.src_w}"\n                        height="${i.src_h}"\n                        data-src="${i.src}"\n                        data-srcset="${i.srcset||""}"\n                        alt="${i.alt||""}"\n                        title="${i.title||""}"\n                        data-caption="${i.data_caption||""}"\n                        loading="eager"\n                        data-large_image="${i.full_src}"\n                        data-large_image_width="${i.full_src_w}"\n                        data-large_image_height="${i.full_src_h}"\n                        sizes="${i.sizes}"\n                    />\n                `)}handleOutOfStockVisibility(e){const n=e||this.data.outOfStockAttributes,i=this.data.$variations.find("li a");i.removeClass("out-of-stock");for(const[e,a]of Object.entries(n))if(a.length){const e=a.slice().map((e=>'[data-id="'+t.escapeSelector(e)+'"]')).join(",");i.filter(e).addClass("out-of-stock")}}getAttributesCombination(){const t=Object.entries(this.getState()).reduce((function(t,[e,n]){return n&&(t[e]=n),t}),{}),e=Object.keys(t),n=Object.values(t),i=[];if(e.length>1)for(let a=0;a<e.length;a++){const o=e[a];if(n[a]){const e=Object.assign({},t);e[o]="",i.push(e)}}return i}getMatchingIntersectionAttributes(t,e,n){const i=e.filter((function(e){return Object.entries(e.attributes).every((function([e,n]){return!t[e]||!n||t[e]===n}))})),a={};for(const[e,o]of Object.entries(n)){const[n,s]=e.split("///");t[n]!==s&&o.forEach((function(t){-1!==i.indexOf(t)&&(a[e]=a[e]||[],-1===a[e].indexOf(t)&&a[e].push(t))}))}return a}findMatchingOutOfStockVariations(){const t=this,e=this.data.variations,n=this.getState(),i=Object.keys(n).filter((function(t){return n[t]})).length,a=[],o={},s={},r={},c={};e.forEach((function(e){const i=t.isMatch(e.attributes,n);i&&a.push(e);for(const[t,n]of Object.entries(e.attributes)){const a=t+"///"+n;r[a]=r[a]||[],-1===r[a].indexOf(e)&&r[a].push(e),e.is_in_stock&&(c[a]=c[a]||[],-1===c[a].indexOf(e)&&c[a].push(e)),i&&(o[a]=o[a]||[],-1===o[a].indexOf(e)&&o[a].push(e),e.is_in_stock&&(s[a]=s[a]||[],-1===s[a].indexOf(e)&&s[a].push(e)))}}));const d={},u=this.getAttributesCombination();if(u.length)u.forEach((function(e){const i=t.getMatchingIntersectionAttributes(e,a,s);for(const[t,e]of Object.entries(i)){const[e,i]=t.split("///");n[e]&&(d[e]=d[e]||[],d[e].push(i))}}));else for(const[t,e]of Object.entries(c)){const[e,a]=t.split("///");(n[e]||0===i)&&(d[e]=d[e]||[],d[e].push(a))}const l=t.getMatchingIntersectionAttributes(n,a,s);for(const[t,e]of Object.entries(l)){const[e,n]=t.split("///");d[e]=d[e]||[],d[e].push(n)}for(const[t,e]of Object.entries(d))d[t]=[...new Set(e)];const h={};for(const[t,e]of Object.entries(r)){const[e,n]=t.split("///");!n||d[e]&&-1!==d[e].indexOf(n)||(h[e]=h[e]||[],h[e].push(n))}return h}findOutOfStockAttributes(){const t=this.data.variations;let e=[],n=[],i={};for(let i=0;i<t.length;i++){let a=t[i];a.is_in_stock?e.push(Object.entries(a.attributes)):n.push(Object.entries(a.attributes))}e=[].concat(...e),n=[].concat(...n);const a=function(t,e){const n=e[0],i=e[1];return t[n]=t[n]||[],t[n].push(i),t},o=e.reduce(a,{}),s=n.reduce(a,{});for(const[t,e]of Object.entries(s)){const n=void 0===o[t];(n||o[t])&&(i[t]=e.filter((function(e){return n||!o[t].includes(e)})))}return i}findFirstMatchingVariationOfGivenState(t){if(!t||0===Object.keys(t).length)return;const e=this.data.variations;for(let n=0;n<e.length;n++){let i=e[n];if(this.isExactMatch(t,i.attributes))return i}}isMatch(t,e){var n=!1;for(var i in t)if(t.hasOwnProperty(i)){var a=t[i],o=e[i];void 0!==a&&void 0!==o&&0!==a.length&&0!==o.length&&a===o&&(n=!0)}return n}isExactMatch(t,e){var n=!0;for(var i in t)if(t.hasOwnProperty(i)){var a=t[i],o=e[i];(void 0===a||void 0===o||0===o.length||0!==a.length&&a!==o)&&(n=!1)}return n}}t.productsVariations=function(n){const i=t(n),a=new The7ElementorSettings(i);let o,s,r,c,d={};t.data(n,"productsVariations",i),d={init:function(){const n=i.find(".quantity");if(n.length){const e=i.find(".box-button"),a=t(".qty",n);a.on("change",(function(){e.attr("data-quantity",parseInt(a.val()))}))}const o=i.find("[data-product_variations]");if(o.length){o.each((function(){const n=t(this),o=n.find(".products-variations"),s=n.find(".box-button");let r;r="the7-woocommerce-loop-add-to-cart.default"===i.data("widget_type")?n.closest('div[data-elementor-type="loop-item"]').find(".price").first():n.find("span.price").first();const c=new e({variations:n.data("product_variations"),$addToCartButton:s,$variations:o,$price:r}),d=[];o.each((function(){const e=t(this),n=e.attr("data-atr"),i=e.find("[data-id]");1===i.length&&d.push({attribute:n,value:i.first().data("id")})}));const u=d.map((function(t){return t.attribute})),l=[...d],h=n.data("default_attributes")||{};for(const[t,e]of Object.entries(h))-1===u.indexOf(t)&&l.push({attribute:t,value:e});const f=l.reduce((function(t,e){return t[e.attribute]=e.value,t}),{});c.findFirstMatchingVariationOfGivenState(f)&&c.updateState(f),o.find("li a").data("the7_product_variations_obj",c).data("the7_must_be_active_attribute_names",u),s.attr("data-product_id",""),s.on("click",(function(e){const n=t(this);if("n"==a.getCurrentDeviceSetting("show_variations"))return e.preventDefault(),void window.location.assign(n.attr("href"));n.is(".add_to_cart_button.variation-btn-disabled")&&e.preventDefault()})),c.render()}));const n=i.find(".products-variations li a");if(t(".touchevents").length){let e,i;n.on("touchstart",(function(t){e=t.originalEvent.touches[0].pageY,i=t.originalEvent.touches[0].pageX})),n.on("touchend",(function(n){n.preventDefault();let a=n.originalEvent.changedTouches[0].pageX,o=n.originalEvent.changedTouches[0].pageY;if(e===o||i===a){const e=t(this);d.selectAttribute(e)}}))}else n.on("click",(function(e){"none"!==t(this).parents().siblings(".woocommerce-variation-add-to-cart").css("display")&&e.preventDefault();const n=t(this);d.selectAttribute(n)}))}if(!!t("html.mobile-true").length){const e=i.find(".trigger-img-hover");e.each((function(){const n=t(this);let o,s;if(n.hasClass("woo-ready"))return;const r=!!n.closest(".product-type-variable",i).length;n.on("touchstart",(function(t){o=t.originalEvent.touches[0].pageY,s=t.originalEvent.touches[0].pageX})),n.on("touchend",(function(n){const i=t(this),c=n.originalEvent.changedTouches[0].pageX,u=n.originalEvent.changedTouches[0].pageY,l=!i.hasClass("is-clicked");let h=l;if(l){let l;if(i.hasClass("woo-buttons-on-img"))l=!0;else{const t=i.find(".woo-buttons-on-img").get(0);l=n.originalEvent&&t&&n.originalEvent.composedPath().includes(t)}if(l&&t(n.target).closest(".products-variations-wrap, .woo-list-buttons",i).length){const t=a.getCurrentDeviceSetting("show_variations_on_hover"),e=a.getCurrentDeviceSetting("show_btn_on_hover");(!r||t&&"on-hover"!==t)&&(e&&"on-hover"!==e)&&(h=!1)}if(o==u||s==c){e.removeClass("is-clicked"),i.addClass("is-clicked");const t={boundaryElement:i.get(0),$affectedElements:e};elementorFrontend.elements.$body.off("touchstart",d.onOuterTouchHandler).on("touchstart",t,d.onOuterTouchHandler)}}h&&n.preventDefault()})),n.addClass("woo-ready")}))}},getProductSlider:function(){if(void 0===o&&void 0!==c){const t=c.find(".elementor-widget-the7-slider-common");o=t.length?t.data("productSlider").getSwiper():null}return o},replaceImage:function(e,n){s||(s=e.first().clone()),c.addClass("replace-is-loading"),r=t(),e.each((function(){t(this).replaceWith((function(){const t=n.clone();return t.on("load",(function(){c.removeClass("replace-is-loading")})),r=r.add(t),t}))})),c.addClass("has-replaced-img"),c.layzrInitialisation()},restoreImage:function(){r&&r.length&&s&&s.length&&(d.replaceImage(r,s),r=void 0,c.removeClass("has-replaced-img"))},updateProductImage:function(e){if(!e||!e.length)return void d.restoreImage();const n=d.getProductSlider();if(n){const i=t(n.wrapperEl).find('img[src="'+e.attr("data-src")+'"]').first();if(i.length)d.restoreImage(),n.slideTo(n.slides.indexOf(i.closest(".the7-swiper-slide")[0]));else{n.slideTo(1);const i=1===n.slides.length?t(n.slides[0]).find("img"):t(n.$wrapperEl).find('.the7-swiper-slide[data-swiper-slide-index="0"]').find("img");d.replaceImage(i,e)}}else{const t=c.find("img").first();t[0].src!==e.attr("data-src")&&d.replaceImage(t,e)}},selectAttribute:function(t){const e=t.data("the7_product_variations_obj"),n=t.closest("ul").attr("data-atr"),o=-1!==t.data("the7_must_be_active_attribute_names").indexOf(n),s=String(t.data("id"));if(o&&e.getState(n)===s)return;const r={[n]:t.parent().hasClass("active")?"":s},u=Object.entries(Object.assign({},e.getState(),r)).reduce(((t,[e,n])=>(n&&(t[e]=n),t)),{});c=i.hasClass("elementor-widget-the7-woocommerce-loop-add-to-cart")?t.closest(".product"):t.closest(".woocom-project"),d.updateProductImage(e.getVariationImage(u)),t.is(".out-of-stock")||"n"===a.getCurrentDeviceSetting("show_add_to_cart")||e.updateState(r)},onOuterTouchHandler:function(t){t.originalEvent&&t.data&&t.data.boundaryElement&&!t.originalEvent.composedPath().includes(t.data.boundaryElement)&&t.data.$affectedElements&&t.data.$affectedElements.removeClass("is-clicked")&&elementorFrontend.elements.$body.off("touchstart",d.onOuterTouchHandler)}},d.init()},t.fn.productsVariations=function(){return this.each((function(){void 0!==t(this).data("productsVariations")&&t(this).removeData("productsVariations"),new t.productsVariations(this)}))}})),jQuery(window).on("elementor/frontend/init",(function(){const t=function(t,e){e((function(){t.productsVariations()}))};elementorFrontend.hooks.addAction("frontend/element_ready/the7-wc-products.default",t),elementorFrontend.hooks.addAction("frontend/element_ready/the7-wc-products-carousel.default",t),elementorFrontend.hooks.addAction("frontend/element_ready/the7-woocommerce-loop-add-to-cart.default",t)}));