!function(t){t(window).on("elementor/frontend/init",(function(){elementorFrontend.hooks.addAction("frontend/element_ready/the7-woocommerce-product-add-to-cart-v2.default",(function(t,e){e((function(){t.productVariations()}))}))})),t.productVariations=function(i){const n=t(i),a=n.find(".the7-vr-options"),s=n.find("[data-product_variations]"),r=n.find("form"),o=r.find(".single_variation");let c,d,l;t.data(i,"productVariations",n);const u={init:function(){if(a.length){const i=new e({variations:s.data("product_variations"),state:s.data("default_attributes")||{},render:function(){const e=this.getState();if(!e)return;const i=Object.entries(e).reduce(((t,[e,i])=>(i&&(t[e]=i),t)),{});u.updateProductImage(this.getVariationImage(i));const n=Object.keys(e).filter((function(t){return!!t})).map((function(i){return'[data-id="'+t.escapeSelector(e[i])+'"]'})).join(","),s=a.find("li");s.removeClass("active"),s.find(n).each((function(){t(this).parent().addClass("active")})),r.find(".variations select").each((function(){const i=t(this),n=i.attr("name");void 0!==e[n]&&e[n]!==i.val()&&i.val(e[n])})).trigger("change"),u.handleOutOfStockVisibility(this.findMatchingOutOfStockVariations4())}});t("li a",a).on("click",(function(e){e.preventDefault();const n=t(this),a=n.closest("ul").attr("data-atr"),s=i.sanitizeAttrSlug(a),r=String(n.data("id"));if(-1!==o.indexOf(a)&&i.getState(s)===r)return;const c=n.parent(),d={[s]:c.hasClass("active")?"":r};i.updateState(d)}));const n=[];a.each((function(){const e=t(this),i=e.attr("data-atr"),a=e.find("[data-id]");1===a.length&&n.push({attribute:i,value:a.first().data("id")})}));const o=n.map((function(t){return t.attribute})),c=[...n];r.find(".variations select").each((function(){const e=t(this),i=e.val(),n=e.attr("id");i.length&&-1===o.indexOf(n)&&c.push({attribute:n,value:i})})),i.updateState(c.reduce((function(t,e){const n=e.value,a=i.sanitizeAttrSlug(e.attribute);return{...t,[a]:n}}),{}))}t(".variations_form").on("reset_data",(function(){u.restoreImage()})),r.on("found_variation",(function(e,i){if(i&&i.image&&i.image.src){const e=t(`\n                            <img\n                                class="replaced-img preload-me aspect lazy lazy-load"\n                                style="--ratio: ${i.image.src_w} / ${i.image.src_h};"\n                                width="${i.image.src_w}"\n                                height="${i.image.src_h}"\n                                data-src="${i.image.src}"\n                                data-srcset="${i.image.srcset||""}"\n                                alt="${i.image.alt||""}"\n                                title="${i.image.title||""}"\n                                data-caption="${i.image.data_caption||""}"\n                                loading="eager"\n                                data-large_image="${i.image.full_src}"\n                                data-large_image_width="${i.image.full_src_w}"\n                                data-large_image_height="${i.image.full_src_h}"\n                                sizes="${i.image.sizes}"\n                            />\n                        `);u.updateProductImage(e)}else u.restoreImage()}));const i=function(){o.children().not(":empty").last().addClass("last")};n.find(".single_variation_wrap").on("show_variation",(function(t,e){i()})),i()},getProductSlider:async function(){return new Promise((t=>{const e=()=>{if(void 0===l){const t=n.closest(".product").find(".elementor-widget-the7-woocommerce-product-images-slider");if(t.length){const i=t.data("the7Slider");i&&(l=i.getSwiper(),void 0===l&&setTimeout(e,100))}else l=null}void 0!==l&&t(l)};e()}))},replaceImage:function(e,i){d||(d=e.first().clone()),n.addClass("replace-is-loading"),c=t(),e.each((function(){var e=t(this),a=e.parent(),s=a.css("background-image");e.data("original-bg")||e.data("original-bg",s),t(this).replaceWith((function(){const t=i.clone();return t.on("load",(function(){n.removeClass("replace-is-loading")})),s&&"none"!==s&&a.css("background-image","url("+t[0].getAttribute("data-src")+")"),c=c.add(t),t}))})),n.addClass("has-replaced-img"),n.closest(".product").find(".elementor-widget-the7-woocommerce-product-images-slider").layzrInitialisation()},restoreImage:function(){c&&c.length&&d&&d.length&&(c.each((function(){var e=t(this),i=e.parent(),n=e.data("original-bg");n&&i.css("background-image",n)})),u.replaceImage(c,d),c=void 0,n.removeClass("has-replaced-img"))},updateProductImage:function(e){if(!e||!e.length)return void u.restoreImage();u.getProductSlider().then((i=>{if(i){const n=t(i.wrapperEl).find('img.is-loaded[srcset*="'+e.attr("data-src")+'"],img[data-srcset*="'+e.attr("data-src")+'"]').first();if(n.length)u.restoreImage(),i.slideTo(i.slides.indexOf(n.closest(".the7-swiper-slide")[0]));else{i.slideTo(0);const n=1===i.slides.length?t(i.slides[0]).find("img"):t(i.$wrapperEl).find('.the7-swiper-slide[data-swiper-slide-index="0"]').find("img");u.replaceImage(n,e)}}}));const i=n.closest(".product").find(".elementor-widget-the7-woocommerce-product-images-vertical-slider");if(i.length){function a(t){return t?t.replace(/-\d+x\d+(?=\.\w{3,4}$)/,"").replace(/-scaled(?=\.\w{3,4}$)/,""):""}var s=a(e.attr("data-src")),r=i.find(".dt-gallery-container img").filter((function(){var e=t(this),i=a(e.attr("src")||""),n=a(e.attr("data-src")||""),r=e.attr("data-srcset")||"";return i===s||n===s||r.includes(s)}));if(r.length){u.restoreImage();var o=r.offset().top-i.offset().top+i.scrollTop()+2;i[0].scrollTo({top:o})}else{const c=i.find(".dt-gallery-container img").first();if(c.length){c.data("original-src")||(c.data("original-src",c.attr("src")),c.data("original-srcset",c.attr("srcset")));const d=c.offset().top-i.offset().top+i.scrollTop()+2;i[0].scrollTo({top:d}),u.replaceImage(c,e),i.layzrInitialisation()}}}},handleOutOfStockVisibility(e){const i=e,n=a.find("li a");n.removeClass("out-of-stock");for(const[e,a]of Object.entries(i))if(a.length){const e=a.slice().map((e=>'[data-id="'+t.escapeSelector(e)+'"]')).join(",");n.filter(e).addClass("out-of-stock")}}};u.init()},t.fn.productVariations=function(){return this.each((function(){void 0!==t(this).data("productVariations")&&t(this).removeData("productVariations"),new t.productVariations(this)}))};class e{constructor(t){this.data=t||{},this.data.outOfStockAttributes=this.findOutOfStockAttributes(),this.data.state=this.data.state||{}}getState(t){return t?this.data.state[t]:Object.assign({},this.data.state)}updateState(t){this.data.state=Object.assign({},this.data.state,t),"function"==typeof this.data.render&&this.data.render.call(this)}sanitizeAttrSlug(t){return 0!==t.indexOf("attribute_")&&(t="attribute_"+t),t}findMatchingVariation(){const t=this.data.variations,e=this.getState();for(var i=[],n=0;n<t.length;n++){var a=t[n];this.isExactMatch(a.attributes,e)&&i.push(a)}return i.shift()}getVariationImage(e){const i=this.findFirstMatchingVariationOfGivenState(e);if(!i)return;const n=i.image;return t(`\n                    <img\n                        class="replaced-img preload-me aspect lazy lazy-load"\n                        style="--ratio: ${n.src_w} / ${n.src_h};"\n                        width="${n.src_w}"\n                        height="${n.src_h}"\n                        data-src="${n.src}"\n                        data-srcset="${n.srcset||""}"\n                        alt="${n.alt||""}"\n                        title="${n.title||""}"\n                        data-caption="${n.data_caption||""}"\n                        loading="eager"\n                        data-large_image="${n.full_src}"\n                        data-large_image_width="${n.full_src_w}"\n                        data-large_image_height="${n.full_src_h}"\n                        sizes="${n.sizes}"\n                    />\n                `)}findAttributesWithOutOfStockVariationsInAttributeMap(t,e){if("function"==typeof e&&"object"==typeof t)for(const[i,n]of Object.entries(t)){const[t,a]=i.split("///");n.every((function(t){return!t.is_in_stock}))&&e(t,a,n)}}getAttributesCombination(){const t=Object.entries(this.getState()).reduce((function(t,[e,i]){return i&&(t[e]=i),t}),{}),e=Object.keys(t),i=Object.values(t),n=[];if(e.length>1)for(let a=0;a<e.length;a++){const s=e[a];if(i[a]){const e=Object.assign({},t);e[s]="",n.push(e)}}return n}getMatchingIntersectionAttributes(t,e,i){const n=e.filter((function(e){return Object.entries(e.attributes).every((function([e,i]){return!t[e]||!i||t[e]===i}))})),a={};for(const[e,s]of Object.entries(i)){const[i,r]=e.split("///");t[i]!==r&&s.forEach((function(t){-1!==n.indexOf(t)&&(a[e]=a[e]||[],-1===a[e].indexOf(t)&&a[e].push(t))}))}return a}findMatchingOutOfStockVariations4(){const t=this,e=this.data.variations,i=this.getState(),n=Object.keys(i).filter((function(t){return i[t]})).length,a=[],s={},r={},o={},c={};e.forEach((function(e){const n=t.isMatch(e.attributes,i);n&&a.push(e);for(const[t,i]of Object.entries(e.attributes)){const a=t+"///"+i;o[a]=o[a]||[],-1===o[a].indexOf(e)&&o[a].push(e),e.is_in_stock&&(c[a]=c[a]||[],-1===c[a].indexOf(e)&&c[a].push(e)),n&&(s[a]=s[a]||[],-1===s[a].indexOf(e)&&s[a].push(e),e.is_in_stock&&(r[a]=r[a]||[],-1===r[a].indexOf(e)&&r[a].push(e)))}}));const d={},l=this.getAttributesCombination();if(l.length)l.forEach((function(e){const n=t.getMatchingIntersectionAttributes(e,a,r);for(const[t,e]of Object.entries(n)){const[e,n]=t.split("///");i[e]&&(d[e]=d[e]||[],d[e].push(n))}}));else for(const[t,e]of Object.entries(c)){const[e,a]=t.split("///");(i[e]||0===n)&&(d[e]=d[e]||[],d[e].push(a))}const u=t.getMatchingIntersectionAttributes(i,a,r);for(const[t,e]of Object.entries(u)){const[e,i]=t.split("///");d[e]=d[e]||[],d[e].push(i)}for(const[t,e]of Object.entries(d))d[t]=[...new Set(e)];const f={};for(const[t,e]of Object.entries(o)){const[e,i]=t.split("///");!i||d[e]&&-1!==d[e].indexOf(i)||(f[e]=f[e]||[],f[e].push(i))}return f}findOutOfStockAttributes(){const t=this.data.variations;let e=[],i=[],n={};for(let n=0;n<t.length;n++){let a=t[n];a.is_in_stock?e.push(Object.entries(a.attributes)):i.push(Object.entries(a.attributes))}e=[].concat(...e),i=[].concat(...i);const a=function(t,e){const i=e[0],n=e[1];return t[i]=t[i]||[],t[i].push(n),t},s=e.reduce(a,{}),r=i.reduce(a,{});for(const[t,e]of Object.entries(r)){const i=void 0===s[t];(i||s[t])&&(n[t]=e.filter((function(e){return i||!s[t].includes(e)})))}return n}findFirstMatchingVariationOfGivenState(t){if(!t||0===Object.keys(t).length)return;const e=this.data.variations;for(let i=0;i<e.length;i++){let n=e[i];if(this.isExactMatch(t,n.attributes))return n}}isMatch(t,e){var i=!1;for(var n in t)if(t.hasOwnProperty(n)){var a=t[n],s=e[n];void 0!==a&&0===a.length&&(a=s),void 0!==a&&void 0!==s&&0!==a.length&&0!==s.length&&a===s&&(i=!0)}return i}isExactMatch(t,e){for(var i in t)if(t.hasOwnProperty(i)){var n=t[i],a=e[i];if(void 0===n||void 0===a||0===a.length||0!==n.length&&n!==a)return!1}return!0}}}(jQuery);